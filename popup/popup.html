<!DOCTYPE html>
<html>
<head>
    <title>Artha-Mitra Expert</title>
    <link rel="stylesheet" href="popup.css">
</head>
<body>
    <div id="notification" class="notification-bar" style="display:none;"></div>

    <!-- UPDATED: View Navigation -->
    <div class="view-nav">
        <button id="nav-analysis" class="nav-btn active">Analysis</button>
        <button id="nav-watchlist" class="nav-btn">Watchlist</button>
        <button id="nav-news" class="nav-btn">News</button>
        <!-- NEW: Sectors Tab -->
        <button id="nav-sectors" class="nav-btn">Sectors</button>
    </div>

    <!-- Header with Cloud Icon -->
    <div class="header-container">
        <h1>Artha-Mitra</h1>
        <svg id="cloudKeyIcon" xmlns="[http://www.w3.org/2000/svg](http://www.w3.org/2000/svg)" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 10h-1.26A8 8 0 1 0 9 20h9a5 5 0 0 0 0-10z"></path></svg>
    </div>

    <!-- Analysis View Wrapper -->
    <div id="analysis-view" style="display:block;">
        <!-- Ticker Input for single stock -->
        <input type="text" id="tickerInput" placeholder="Enter Single Ticker (e.g., AAPL)">
        <!-- UPDATED: Single button for all actions -->
        <button id="runDcfValuationButton">Run DCF Valuation</button>

        <div id="loading" style="display:none; color: orange;">
            <p>Contacting Gemini for DCF Parameters & Rationale...</p>
        </div>

        <!-- This container holds the new DCF interface -->
        <div id="dcf-container" style="display:none;">
            
            <!-- UPDATED: Header with Heart Icon -->
            <div class="stock-header-wrapper">
                <div>
                    <h2 id="stockHeader" style="margin-bottom: 0;"></h2>
                    <p id="priceInfo" style="margin-top: 2px; font-size: 0.9em;"></p>
                </div>
                <!-- NEW: Heart Icon -->
                <svg id="favorite-heart" xmlns="[http://www.w3.org/2000/svg](http://www.w3.org/2000/svg)" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="heart-icon" style="display:none;">
                    <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path>
                </svg>
            </div>

            <!-- NEW: Investment Strategy Display -->
            <div id="strategy-display" style="background-color: #f0f4f8; padding: 10px; border-radius: 4px; margin-top: 10px; border-left: 3px solid #007bff; display:none;">
                <h4 style="margin: 0 0 5px 0;">Recommended Strategy</h4>
                <strong id="strategy-value" style="font-size: 1.1em; color: #0056b3;"></strong>
            </div>

            <!-- DCF Input Parameters -->
            <div id="dcf-inputs" style="margin-top: 10px;">
                
                <!-- UFCF Components -->
                <h4 class="param-header">UFCF Components (TTM, in Millions)</h4>
                <div class="dcf-parameter">
                    <label>NOPAT</label>
                    <div class="input-group">
                        <input type="number" id="input-ttmNopat" step="100">
                    </div>
                </div>
                <div class="dcf-parameter">
                    <label>+ D&A</label>
                    <div class="input-group">
                        <input type="number" id="input-ttmDna" step="100">
                    </div>
                </div>
                <div class="dcf-parameter">
                    <label>- CapEx</label>
                    <div class="input-group">
                        <input type="number" id="input-ttmCapex" step="100">
                    </div>
                </div>
                <div class="dcf-parameter">
                    <label>- &Delta; NWC</label>
                    <div class="input-group">
                        <input type="number" id="input-ttmNwc" step="100">
                    </div>
                </div>
                 <div class="dcf-parameter">
                    <label>UFCF Growth (5-Yr)</label>
                    <div class="input-group">
                        <button class="adjust-btn" data-field="ufcfGrowth" data-op="-">-</button>
                        <input type="number" id="input-ufcfGrowth" step="0.005">
                        <button class="adjust-btn" data-field="ufcfGrowth" data-op="+">+</button>
                    </div>
                </div>

                <!-- WACC Components -->
                <h4 class="param-header">WACC Components (Values in Millions)</h4>
                <div class="dcf-parameter">
                    <label>Market Val Equity (E)</label>
                    <div class="input-group">
                        <input type="number" id="input-marketEquity" step="1000">
                    </div>
                </div>
                <div class="dcf-parameter">
                    <label>Market Val Debt (D)</label>
                    <div class="input-group">
                        <input type="number" id="input-marketDebt" step="1000">
                    </div>
                </div>
                <div class="dcf-parameter">
                    <label>Cost of Equity (Re)</label>
                    <div class="input-group">
                        <button class="adjust-btn" data-field="costEquity" data-op="-">-</button>
                        <input type="number" id="input-costEquity" step="0.001">
                        <button class="adjust-btn" data-field="costEquity" data-op="+">+</button>
                    </div>
                </div>
                <div class="dcf-parameter">
                    <label>Cost of Debt (Rd)</label>
                    <div class="input-group">
                         <button class="adjust-btn" data-field="costDebt" data-op="-">-</button>
                        <input type="number" id="input-costDebt" step="0.001">
                         <button class="adjust-btn" data-field="costDebt" data-op="+">+</button>
                    </div>
                </div>
                <div class="dcf-parameter">
                    <label>Tax Rate (t)</label>
                    <div class="input-group">
                        <button class="adjust-btn" data-field="taxRate" data-op="-">-</button>
                        <input type="number" id="input-taxRate" step="0.001">
                        <button class="adjust-btn" data-field="taxRate" data-op="+">+</button>
                    </div>
                </div>

                <!-- Equity Value Components -->
                <h4 class="param-header">Equity Value Components (in Millions)</h4>
                <div class="dcf-parameter">
                    <label>Net Debt</label>
                    <div class="input-group">
                        <button class="adjust-btn" data-field="netDebt" data-op="-">-</button>
                        <input type="number" id="input-netDebt" step="100">
                        <button class="adjust-btn" data-field="netDebt" data-op="+">+</button>
                    </div>
                </div>
                 <div class="dcf-parameter">
                    <label>Shares Outstanding</label>
                    <div class="input-group">
                        <button class="adjust-btn" data-field="shares" data-op="-">-</button>
                        <input type="number" id="input-shares" step="10">
                        <button class="adjust-btn" data-field="shares" data-op="+">+</button>
                    </div>
                </div>
                <div class="dcf-parameter">
                    <label>Perpetual Growth (g)</label>
                    <div class="input-group">
                        <button class="adjust-btn" data-field="perpGrowth" data-op="-">-</button>
                        <input type="number" id="input-perpGrowth" step="0.001">
                        <button class="adjust-btn" data-field="perpGrowth" data-op="+">+</button>
                    </div>
                </div>
            </div>

            <!-- Final Calculation Results -->
            <div id="final-results" style="display:none; margin-top: 15px; background-color: #fff; padding: 10px; border-radius: 4px; box-shadow: 0 2px 4px rgba(0,0,0,0.05);">
                <h3>Calculated Intrinsic Value: <span id="intrinsicValue" style="color: #007bff;"></span></h3>
                <h4>Base UFCF: <span id="baseUfcfValue" style="color: #333; font-weight: 500;"></span></h4>
                <h4>WACC: <span id="waccValue" style="color: #333; font-weight: 500;"></span></h4>
                
                <h3 style="margin-top: 15px;">Analyst Consensus Targets</h3>
                <ul id="analystEstimateTargets" style="list-style: none; padding-left: 0; margin-top: 10px;">
                    <!-- JS will populate this with analyst data -->
                </ul>
            </div>

            <!-- Rationale Section -->
            <div id="rationaleSection" style="display:none; margin-top: 10px; border-top: 1px solid #eee;">
                <h4>AI Rationale for Parameters</h4>
                <div id="rationaleDetails">
                    <!-- ADDED: Sectoral Megatrends -->
                    <h5>Sectoral Megatrends</h5>
                    <pre id="rationale-megatrends"></pre>

                    <!-- ADDED: Fundamental SWOT -->
                    <h5>Fundamental SWOT</h5>
                    <pre id="rationale-swot"></pre>

                    <!-- NEW: Investment Strategy Rationale -->
                    <h5>Recommended Strategy</h5>
                    <pre id="rationale-strategy"></pre>

                    <h5>UFCF Components & Growth</h5>
                    <pre id="rationale-ufcf"></pre>
            
                    <h5>WACC Components</h5>
                    <pre id="rationale-wacc"></pre>

                    <h5>Net Debt</h5>
                    <pre id="rationale-netDebt"></pre>
            
                    <h5>Shares Outstanding</h5>
                    <pre id="rationale-shares"></pre>

                    <h5>Perpetual Growth</h5>
                    <pre id="rationale-perpGrowth"></pre>

                    <!-- ADDED: Rationale for Analyst Consensus -->
                    <h5>Analyst Consensus</h5>
                    <pre id="rationale-analystConsensus"></pre>
                </div>
            </div>
        </div>
    </div> <!-- End of analysis-view -->

    <!-- Watchlist View -->
    <div id="watchlist-view" style="display:none;">
        <h2>My Watchlist</h2>
        <div id="watchlist-content">
            <!-- Watchlist items will be populated here by JS -->
        </div>
    </div>

    <!-- NEW: News View -->
    <div id="news-view" style="display:none;">
        
        <!-- UPDATED: Header with status icon -->
        <div style="display: flex; align-items: center; justify-content: space-between;">
             <h2 style="border-bottom: none; padding-bottom: 0;">Global News Impact</h2>
             <!-- NEW: News Status Icon -->
             <div id="news-status-icon" title="News data status"></div>
        </div>
        
        <!-- Sub-navigation for news timeframe -->
        <div class="sub-nav">
            <button id="news-12h" class="sub-nav-btn active" data-timeframe="12 hours">Last 12 Hours</button>
            <button id="news-7d" class="sub-nav-btn" data-timeframe="7 days">Last 7 Days</button>
            <button id="news-3m" class="sub-nav-btn" data-timeframe="3 months">Last 3 Months</button>
        </div>

        <div id="news-loading" style="display:none; color: orange; padding: 10px; text-align: center;">
            <p>Gemini is scanning global news...</p>
        </div>
        
        <div id="news-content" style="display: none;">
            <!-- News items will be populated here by JS -->
        </div>
    </div>

    <!-- NEW: Sectors View -->
    <div id="sectors-view" style="display:none;">
        
        <!-- UPDATED: Header with status icon -->
        <div style="display: flex; align-items: center; justify-content: space-between;">
            <h2 style="border-bottom: none; padding-bottom: 0;">Sectoral Rotation</h2>
            <!-- NEW: Sector Status Icon -->
            <div id="sector-status-icon" title="Sector data status"></div>
        </div>

        <div id="sectors-loading" style="display:none; color: orange; padding: 10px; text-align: center;">
            <p>Fetching sector performance from Alpha Vantage...</p>
        </div>
        
        <div id="sectors-content" style="display: none; max-height: 450px; overflow-y: auto;">
            <!-- Sector rotation table will be populated here by JS -->
        </div>
    </div>


    <!-- API Key Modal (hidden by default) -->
    <div id="apiKeyModal" class="modal-container">
        <div class="modal-content">
            <span class="close-button">&times;</span>
            
            <!-- UPDATED: Gemini Key Section -->
            <h4>Gemini (AI Analysis)</h4>
            <p>Enter your Gemini Cloud API key to enable the analysis models.</p>
            <input type="password" id="geminiApiKeyInput" placeholder="Enter Gemini Cloud API Key">
            <button id="saveApiKeyButton">Save Gemini Key</button>
            <p id="keyStatus" style="font-size: 0.8em; margin-top: 5px;"></p>
            
            <!-- NEW: Alpha Vantage Key Section -->
            <h4 style="margin-top: 15px;">Alpha Vantage (Stock Data)</h4>
            <p>Enter your free Alpha Vantage API key for sector analysis.</p>
            <input type="password" id="alphaVantageApiKeyInput" placeholder="Enter Alpha Vantage API Key">
            <button id="saveAlphaVantageApiKeyButton">Save Alpha Vantage Key</button>
            <p id="alphaVantageKeyStatus" style="font-size: 0.8em; margin-top: 5px;"></p>
        </div>
    </div>

    <script src="popup.js"></script>
</body>
</html>
